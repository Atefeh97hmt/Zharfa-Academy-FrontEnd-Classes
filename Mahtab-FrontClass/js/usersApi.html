<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>users</title>
</head>

<body>


    <header>

        <input id="search" placeholder="seaching name ...">

        <select id="countrySelect">

            <option value="all">all countries</option>

        </select>

    </header>

    <div id="cards" class="grid">




    </div>



    <script>

        let users = [];
        let searchInput = document.getElementById('search');
        let countrySelect = document.getElementById('countrySelect');
        let cardEl = document.getElementById('cards')

        function loadUsers() {

            fetch('https://randomuser.me/api/?results=10')
                .then(function (res) { return res.json(); })
                .then(function (data) {
                    users.data.results.map(function (u) {

                        return {
                            name: u.name.first + ' ' + u.name.last,
                            country: u.location.country,
                            email: u.email,
                            avatar: u.picture.medium
                        }



                    })
                    fillCountries()
                    render();
                })


        }

        function fillCountries() {

            let cs = users.map(function (u) { return u.country })

            cs = cs.filter(function (v, i, a) { return a.indexOf(v) === i })

            cs.sort();
            countrySelect.innerHTML = '<option value = "all"> all countries  </option> '
            cs.forEach(function (c) {
                let o = document.createElement('option');
                o.value = c;
                o.textContent = c;
                countrySelect.appendChild(o)

            })
        }



        function render() {
            var q = searchInput.value.toLowerCase();
            var country = countrySelect.value;
            var list = users.filter(function (u) {
                if (country !== 'all' && u.country !== country) return false;
                if (q && u.name.toLowerCase().indexOf(q) === -1) return false;
                return true;
            });


            cardEl.innerHTML = '';
            list.forEach(function (u) {
                var card = document.createElement('div');
                card.className = 'card'
                card.innerHTML =
                    '<img class="avatar" src="' + u.avatar + '" > ' +
                    '<div>' +
                    '<div class = "name">' + u.name + '</div>' +
                    '<div class = "meta">' + u.country + ' <br>' + u.email + '</div>' +
                    '</div>';
                cardEl.appendChild(card);
            });

            if (list.length === 0) { cardEl.innerHTML = '<div>nothing founded</div>' }


        }


        searchInput.addEventListener('input', render);
        countrySelect.addEventListener('change', render);


        loadUsers()
    </script>





</body>

</html>